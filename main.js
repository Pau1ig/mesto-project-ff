(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(n){n.target.classList.contains("popup_is-opened")&&t(e),n.target.classList.contains("popup__close")&&t(e)}))}));var o=document.querySelector("#card-template").content,r=document.querySelector(".popup_type_image"),c=document.querySelector(".popup__caption"),a=r.querySelector(".popup__image"),i=document.querySelector(".places__list");function u(t,n,u,l){var d=function(t,n,i,u,l,d){var p=o.querySelector(".places__item").cloneNode(!0),f=p.querySelector(".card__image"),_=p.querySelector(".card__delete-button"),m=p.querySelector(".card__like-button"),y=p.querySelector(".card__like_count");return p.querySelector(".card__id").textContent=l,p.querySelector(".card__title").textContent=t,f.src=n,f.alt=t,y.textContent=i.length,f.addEventListener("click",(function(){a.src=n,a.alt=t,c.textContent=t,e(r)})),d&&m.classList.add("card__like-button_is-active"),u?_.addEventListener("click",A):(_.style.display="none",_.removeEventListener("click",A)),m.addEventListener("click",s),p}(t.name,t.link,t.likes,u,t._id,l);i[n](d)}function l(e){e.target.classList.toggle("card__like-button_is-active")}function s(e){e.target.classList.contains("card__like-button_is-active")?function(e){var t=e.target.closest(".places__item").querySelector(".card__id").textContent;fetch("".concat(C.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:C.headers}).then((function(e){return L(e)})).then((function(t){e.target.closest(".places__item").querySelector(".card__like_count").textContent=t.likes.length,l(e)})).catch((function(e){console.log(e)}))}(e):function(e){var t=e.target.closest(".places__item").querySelector(".card__id").textContent;fetch("".concat(C.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:C.headers}).then((function(e){return L(e)})).then((function(t){e.target.closest(".places__item").querySelector(".card__like_count").textContent=t.likes.length,l(e)})).catch((function(e){console.log(e)}))}(e)}var d=document.forms.edit_profile,p=d.elements.name,f=d.elements.description,_=document.querySelector(".profile__title"),m=document.querySelector(".profile__description"),y=document.querySelector(".popup_type_edit"),h=document.forms.edit_avatar,v=document.querySelector(".popup_type_edit_avatar"),S=document.forms.new_place,b=document.querySelector(".popup_type_new-card"),q=document.querySelector(".profile__image"),g=h.elements.link,E=S.elements.place_name,k=S.elements.link,C={baseUrl:"https://nomoreparties.co/v1/wff-cohort-13",headers:{authorization:"77b87e4d-b390-4e14-8b80-4ec91748b902","Content-Type":"application/json"}},L=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},x=[fetch("".concat(C.baseUrl,"/users/me"),{headers:C.headers}).then((function(e){return L(e)})),fetch("".concat(C.baseUrl,"/cards"),{headers:C.headers}).then((function(e){return L(e)}))],A=function(e){var t=e.target.closest(".places__item").querySelector(".card__id").textContent;return console.log(t),fetch("".concat(C.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:C.headers}).then((function(e){return L(e)})).then((function(){!function(e){e.target.closest(".places__item").remove()}(e)})).catch((function(e){console.log(e)}))};function U(e,t){t.target.querySelector(".popup__button").textContent=e?"Сохранение...":"Сохранить"}var w={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error"},T=function(e,t){Array.from(e.querySelectorAll(".".concat(t.inputErrorClass))).forEach((function(n){D(e,n,t)}));var n=e.querySelector(t.submitButtonSelector),o=Array.from(e.querySelectorAll(t.inputSelector));P(o,n,t),n.disabled=!0},D=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},P=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.disabled=!1:t.disabled=!0},N=document.querySelector(".profile__edit-button"),O=document.querySelector(".profile__add-button");Promise.all(x).then((function(e){var t=e[0],n=e[1];_.textContent=t.name,m.textContent=t.about,q.style["background-image"]="url(".concat(t.avatar,")"),n.forEach((function(e){var n,o;u(e,"append",e.owner._id===t._id,(n=t,(o=e.likes).length>0&&o.some((function(e){return e._id===n._id}))))}))})).catch((function(e){console.log(e)})),Array.from(document.querySelectorAll(w.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(w.inputSelector)),n=e.querySelector(w.submitButtonSelector);P(t,n),t.forEach((function(o){o.addEventListener("input",(function(){P(t,n),function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?D(e,t,w):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,w)}(e,o)}))}))}(e)})),q.addEventListener("click",(function(){T(v.querySelector(w.formSelector),w),S.reset(),e(v)})),O.addEventListener("click",(function(){T(b.querySelector(w.formSelector),w),S.reset(),e(b)})),N.addEventListener("click",(function(){p.value=_.textContent,f.value=m.textContent,T(y.querySelector(w.formSelector),w),e(y)})),h.addEventListener("submit",(function(e){e.preventDefault(),U(!0,e),fetch("".concat(C.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:C.headers,body:JSON.stringify({avatar:g.value})}).then((function(e){return L(e)})).then((function(e){q.style["background-image"]="url(".concat(e.avatar,")")})).catch((function(e){console.log(e)})).finally((function(){U(!1,e)})),h.reset(),t(v)})),d.addEventListener("submit",(function(e){e.preventDefault(),U(!0,e),fetch("".concat(C.baseUrl,"/users/me"),{method:"PATCH",headers:C.headers,body:JSON.stringify({name:p.value,about:f.value})}).then((function(e){return L(e)})).then((function(e){_.textContent=e.name,m.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){U(!1,e)})),t(y)})),S.addEventListener("submit",(function(e){e.preventDefault(),U(!0,e),fetch("".concat(C.baseUrl,"/cards"),{method:"POST",headers:C.headers,body:JSON.stringify({name:E.value,link:k.value})}).then((function(e){return L(e)})).then((function(e){u(e,"prepend","true")})).catch((function(e){console.log(e)})).finally((function(){U(!1,e)})),S.reset(),t(b)}))})();